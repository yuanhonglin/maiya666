(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/kefuPage/kefuPage"],{1941:function(e,t,a){"use strict";a.r(t);var n=a("709f"),s=a("58d6");for(var o in s)"default"!==o&&function(e){a.d(t,e,function(){return s[e]})}(o);a("b779");var r,i=a("f0c5"),u=Object(i["a"])(s["default"],n["b"],n["c"],!1,null,"740d491f",null,!1,n["a"],r);t["default"]=u.exports},4179:function(e,t,a){},"58d6":function(e,t,a){"use strict";a.r(t);var n=a("9238"),s=a.n(n);for(var o in n)"default"!==o&&function(e){a.d(t,e,function(){return n[e]})}(o);t["default"]=s.a},"709f":function(e,t,a){"use strict";var n,s=function(){var e=this,t=e.$createElement;e._self._c},o=[];a.d(t,"b",function(){return s}),a.d(t,"c",function(){return o}),a.d(t,"a",function(){return n})},9238:function(e,t,a){"use strict";(function(e,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=o(a("a34a"));function o(e){return e&&e.__esModule?e:{default:e}}function r(e){return g(e)||u(e)||i()}function i(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function u(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function g(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}function c(e,t,a,n,s,o,r){try{var i=e[o](r),u=i.value}catch(g){return void a(g)}i.done?t(u):Promise.resolve(u).then(n,s)}function f(e){return function(){var t=this,a=arguments;return new Promise(function(n,s){var o=e.apply(t,a);function r(e){c(o,n,s,r,i,"next",e)}function i(e){c(o,n,s,r,i,"throw",e)}r(void 0)})}}var h=function(){return a.e("components/chat/myChatInput").then(a.bind(null,"c310"))},l=function(){return a.e("components/loadmore/loadmore").then(a.bind(null,"ba09"))},d=a("e25f"),m=a("702d"),p=a("2047"),v="",y=!1,M={components:{chatInput:h,tuiLoadmore:l},data:function(){return{loadding:!1,total:0,scrollInoViewID:"",mathNumber:Math.floor(5*Math.random()+10),username:{yourName:"",myName:""},myHXId:"",myPhoto:"",shopPhoto:"",chatMsg:[],hisMessage:{toId:"",pageNo:1,pageSize:10},historyMsgList:[]}},watch:{chatMsg:function(t){this.chatMsg=t,e("log",this.chatMsg," at pages\\kefuPage\\kefuPage.vue:102")},inputInfo:function(e){this.showSend=!!e},isFocus:function(e){e&&(this.showOption=!1)}},onLoad:function(t){var a=this;e("log",getApp().globalData.memberList," at pages\\kefuPage\\kefuPage.vue:118");var s=JSON.parse(t.memberObj),o=n.getStorageSync("myHXId");this.myHXId=o,this.username={yourName:s.yourName,myName:o},e("log",s," at pages\\kefuPage\\kefuPage.vue:129"),getApp().globalData.memberList.forEach(function(e,t){(e.name=s.yourName)&&(a.shopPhoto=e.avatar,n.setNavigationBarTitle({title:e.nickName}))}),this.hisMessage.toId=s.yourName,this.getHistoryMessage()},onUnload:function(){m.fire("em.chatroom.leave")},onShow:function(){e("log",666," at pages\\kefuPage\\kefuPage.vue:161"),this.create_or_onready()},methods:{create_or_onready:function(){var e=this,t=e.username,a=n.getStorageSync("myHXId"),s=t.yourName+a,o=n.getStorageSync(s)||[];n.setStorageSync(s,null),e.renderMsg(null,null,o,s),m.on("em.xmpp.error.sendMsgErr",function(e){v=e.data.mid,y=!0}),d.on("newChatMsg",function(a,n,o,r){a.info.from!=t.yourName&&a.info.to!=t.yourName||r==s&&e.renderMsg(a,n,o,s,"newMsg")})},renderMsg:function(t,a,s,o,r){var i=this,u=n.getStorageSync("rendered_"+o)||[];u=i.unique(u.concat(s)),u.length&&("newMsg"==r?(i.chatMsg=i.unique(i.chatMsg.concat(s)),i.scrollInoViewID=i.chatMsg[i.chatMsg.length-1].mid):(i.chatMsg=u.slice(-10),i.scrollInoViewID=u[u.length-1].mid,i.historyMsgList.length<=0?(i.chatMsg=u.slice(-10),i.scrollInoViewID=u[u.length-1].hxMsgId):(i.chatMsg=i.historyMsgList.reverse().slice(-10),i.scrollInoViewID=i.historyMsgList[i.historyMsgList.length-1].hxMsgId)),e("log","打印的消息",this.chatMsg," at pages\\kefuPage\\kefuPage.vue:266"),n.setStorageSync("rendered_"+o,u.slice(-20)),y&&i.renderFail(o),e("log",i.chatMsg," at pages\\kefuPage\\kefuPage.vue:289"))},unique:function(e){var t=[];return e.forEach(function(e,a){if(0===a)t.push(e);else{for(var n=!0,s=0;s<t.length;s++)e.mid===t[s].mid&&(n=!1);n&&t.push(e)}}),t},renderFail:function(e){var t=this,a=t.chatMsg;a.map(function(e){e.mid.substring(e.mid.length-10)==v.substring(v.length-10)&&(e.msg.data[0].isFail=!0,e.isFail=!0,t.chatMsg=a)}),t.curChatMsg[0].mid==v&&(t.curChatMsg[0].msg.data[0].isShow=!1,t.curChatMsg[0].isShow=!1),n.setStorageSync("rendered_"+e,a.slice(-20)),y=!1},replySubmit:function(t){var a=this;if(String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")},t.trim()){var s=this.$im.conn.getUniqueId(),o=new this.$im.message(p.TEXT,s);o.set({msg:t,from:this.username.myName,to:this.username.yourName,ext:{fromName:n.getStorageSync("myHXId"),fromAvatar:this.$store.state.userInfo.avatar,hxMsgId:p.TEXT+s,myName:this.$store.state.userInfo.username},roomType:!1,success:function(e,a){m.fire("em.chat.sendSuccess",e,t)},fail:function(t,a){e("log","消息发送失败"," at pages\\kefuPage\\kefuPage.vue:366")}});try{e("log","发送成功"," at pages\\kefuPage\\kefuPage.vue:370"),n.setStorage({key:"cool",data:"1",success:function(t){e("log","success"," at pages\\kefuPage\\kefuPage.vue:375"),a.$im.conn.send(o.body)}})}catch(r){e("log","当前消息发送失败",r," at pages\\kefuPage\\kefuPage.vue:381")}e("log",o,p.TEXT," at pages\\kefuPage\\kefuPage.vue:385"),d.saveMsg(o,p.TEXT)}},getHistoryMessage:function(){var t=this;this.$flyApi.getMessage(this.hisMessage).then(function(a){t.chatMsg=a.data.records.reverse(),e("log",t.chatMsg," at pages\\kefuPage\\kefuPage.vue:396"),t.total=a.data.total})},scrollToupper:function(){var t=f(s.default.mark(function t(a){var n,o,i;return s.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!a.detail.direction||this.loadding){t.next=17;break}if(this.loadding=!0,e("log",this.total," at pages\\kefuPage\\kefuPage.vue:408"),e("log",this.chatMsg.length," at pages\\kefuPage\\kefuPage.vue:409"),!(this.total>this.chatMsg.length)){t.next=16;break}return this.hisMessage.pageNo++,t.next=8,this.$flyApi.getMessage(this.hisMessage).then(function(t){e("log",t," at pages\\kefuPage\\kefuPage.vue:414"),n=t,e("log",n.data," at pages\\kefuPage\\kefuPage.vue:416")});case 8:o=n.data.records.reverse(),i=[].concat(r(o),r(this.chatMsg)),e("log",n," at pages\\kefuPage\\kefuPage.vue:423"),this.chatMsg=i,e("log",this.chatMsg," at pages\\kefuPage\\kefuPage.vue:425"),this.loadding=!1,t.next=17;break;case 16:this.loadding=!1;case 17:case"end":return t.stop()}},t,this)}));function a(e){return t.apply(this,arguments)}return a}()}};t.default=M}).call(this,a("0de9")["default"],a("6e42")["default"])},aea0:function(e,t,a){"use strict";(function(e){a("0a10"),a("921b");n(a("66fd"));var t=n(a("1941"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,a("6e42")["createPage"])},b779:function(e,t,a){"use strict";var n=a("4179"),s=a.n(n);s.a}},[["aea0","common/runtime","common/vendor"]]]);