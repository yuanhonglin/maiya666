(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["common/main"],{"57eb":function(e,t,o){"use strict";(function(e,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(o("66fd"));function r(e){return e&&e.__esModule?e:{default:e}}o("0eb4");var c=o("e985"),i=o("9e98"),s=o("44dd"),u=!1,p=!1,l={globalData:{unReadMessageNum:0,memberList:[],client:""},onLaunch:function(){var t=this,o=e.getStorageSync("isLogin");o||e.navigateTo({url:"pages/views/register/newUser"}),plus.screen.lockOrientation("portrait-primary"),e.getSystemInfo({success:function(e){n("log",e," at App.vue:62"),n("log",e.platform," at App.vue:64"),n("log",e.model," at App.vue:66")}}),e.getSystemInfo({success:function(e){var t=e.statusBarHeight,o=0;a.default.prototype.StatusBar=t,"android"==e.platform?(a.default.prototype.CustomBar=e.statusBarHeight+44,o=e.statusBarHeight+44):(a.default.prototype.CustomBar=e.statusBarHeight+45,o=e.statusBarHeight+45),a.default.mixin({data:function(){return{CustomBar:o,StatusBar:t}}})}});var r=this;s.on("em.main.ready",function(){r.calcUnReadSpot()}),s.on("em.chatroom.leave",function(){n("log","em.chatroom.leave"," at App.vue:116"),r.calcUnReadSpot()}),s.on("em.chat.session.remove",function(){r.calcUnReadSpot()}),s.on("em.chat.audio.fileLoaded",function(){r.calcUnReadSpot()}),s.on("em.main.deleteFriend",function(){r.calcUnReadSpot()}),s.on("em.chat.audio.fileLoaded",function(){r.calcUnReadSpot()}),this.$im.conn.listen({onOpened:function(o){t.$im.conn.setPresence(),n("log","环信登陆成功环信登陆成功环信登陆成功环信登陆成功环信登陆成功环信登陆成功"," at App.vue:136"),o.accessToken&&e.setStorageSync("HuanXinToken",o.accessToken),n("log",o," at App.vue:138"),p&&(e.hideToast(),p=!1)},onReconnect:function(){t.$helper.toast("loading","重连中...",2e3)},onSocketConnected:function(){n("log","环信登陆成功环信登陆成功环信登陆成功环信登陆成功环信登陆成功环信登陆成功"," at App.vue:155")},onClosed:function(){n("log","连接关闭回调"," at App.vue:158"),t.$helper.toast("none","网络已断开",2e3),e.redirectTo({url:"pages/login/login"}),t.$conn.closed=!0,t.$im.conn.close()},onInviteMessage:function(e){t.$options.globalData.saveGroupInvitedList.push(e),s.fire("em.xmpp.invite.joingroup",e)},onPresence:function(e){n("log","onPresence",e," at App.vue:182")},onRoster:function(e){n("log","连接成功回调",e," at App.vue:273")},onVideoMessage:function(e){n("log","onVideoMessage: ",e," at App.vue:281"),e&&c.saveReceiveMsg(e,i.VIDEO),t.calcUnReadSpot(e),t.ack(e)},onAudioMessage:function(e){n("log","onAudioMessage",e," at App.vue:290"),e&&(t.onMessageError(e)&&c.saveReceiveMsg(e,i.AUDIO),t.calcUnReadSpot(e),t.ack(e))},onCmdMessage:function(e){n("log","onCmdMessage",e," at App.vue:301"),e&&(t.onMessageError(e)&&c.saveReceiveMsg(e,i.CMD),t.calcUnReadSpot(e),t.ack(e))},onTextMessage:function(e){n("log","收到文本消息",e," at App.vue:319"),e&&(t.onMessageError(e)&&c.saveReceiveMsg(e,i.TEXT),t.calcUnReadSpot(e),t.ack(e))},onEmojiMessage:function(e){n("log","收到表情消息",e," at App.vue:332"),e&&(t.onMessageError(e)&&c.saveReceiveMsg(e,i.EMOJI),t.calcUnReadSpot(e),t.ack(e))},onPictureMessage:function(e){n("log","收到图片消息",e," at App.vue:343"),e&&(t.onMessageError(e)&&c.saveReceiveMsg(e,i.IMAGE),t.calcUnReadSpot(e),t.ack(e))},onFileMessage:function(e){n("log","收到文件消息",e," at App.vue:354"),e&&(t.onMessageError(e)&&c.saveReceiveMsg(e,i.FILE),t.calcUnReadSpot(e),t.ack(e))},onError:function(o){if(n("log","失败回调",o," at App.vue:366"),o.type==t.$im.statusCode.WEBIM_CONNCTION_DISCONNECTED&&!u){n("log",t.$im.conn.autoReconnectNumTotal,t.$im.conn.autoReconnectNumMax," at App.vue:369"),e.showToast({icon:"none",title:"聊天服务重连，请稍后重试",duration:1500});var a={apiUrl:t.$im.config.apiURL,user:e.getStorageSync("myUsername"),pwd:"123456",appKey:t.$im.config.appkey,success:function(t){e.hideLoading(),u=!1;t=t.access_token;e.setStorageSync("HuanXinToken",t)},error:function(){u=!0}};t.$im.conn.open(a)}if(o.type==t.$im.statusCode.WEBIM_CONNCTION_SERVER_ERROR&&(e.showToast({icon:"none",title:"账号多端登录，请重新登录",duration:1500}),setTimeout(function(){e.reLaunch({url:"/pages/login/login"})},1500)),o.type==t.$im.statusCode.WEBIM_CONNCTION_OPEN_ERROR&&s.fire("em.xmpp.error.passwordErr"),o.type==t.$im.statusCode.WEBIM_CONNCTION_AUTH_ERROR&&s.fire("em.xmpp.error.tokenErr"),"socket_error"==o.type){n("log","网络已断开socket_errorsocket_error",o," at App.vue:430");a={apiUrl:t.$im.config.apiURL,user:e.getStorageSync("myUsername"),pwd:"isong123456",appKey:t.$im.config.appkey,success:function(t){e.hideLoading(),u=!1;t=t.access_token;e.setStorageSync("HuanXinToken",t)},error:function(){u=!0}};n("log",a," at App.vue:453"),t.$im.conn.open(a)}}}),n("log","isOpened",this.$im.conn.isOpened()," at App.vue:458"),n("log",e.getStorageSync("HuanXinToken")," at App.vue:459"),n("log",e.getStorageSync("myUsername")," at App.vue:460"),n("log",e.getStorageSync(this.$store.state.userToken)," at App.vue:461"),setTimeout(function(){!t.$im.conn.isOpened()&&e.getStorageSync("HuanXinToken")&&e.getStorageSync("myUsername")&&t.$store.state.userToken&&(p=!0,t.$conn.open({apiUrl:t.$im.config.apiURL,user:e.getStorageSync("myUsername"),accessToken:e.getStorageSync("HuanXinToken"),appKey:t.$im.config.appkey}))},1e3)},methods:{onLoginSuccess:function(){e.hideToast(),e.switchTab({url:"../chat/chat"})},ack:function(e){var t=e.id,o=new this.$im.message("read",this.$im.conn.getUniqueId());o.set({id:t,to:e.from}),this.$im.conn.send(o.body)},onMessageError:function(t){return"error"!==t.type||(e.showToast({title:t.errorText}),!1)},getCurrentRoute:function(){var e=getCurrentPages(),t=e[e.length-1];return t.route},calcUnReadSpot:function(t){var o=e.getStorageSync("myUsername"),n=this.$options.globalData.memberList||[],a=n.reduce(function(t,n,a){var r;return r=n.roomId?e.getStorageSync(n.roomId+o.toLowerCase())||[]:e.getStorageSync(n.name.toLowerCase()+o.toLowerCase())||[],t+r.length},0);this.$options.globalData.unReadMessageNum=a,s.fire("em.xmpp.unreadspot",t)}},onShow:function(){},onHide:function(){}};t.default=l}).call(this,o("6e42")["default"],o("0de9")["default"])},7154:function(e,t,o){"use strict";o.r(t);var n=o("d7c3");for(var a in n)"default"!==a&&function(e){o.d(t,e,function(){return n[e]})}(a);o("ef89");var r,c,i,s,u=o("f0c5"),p=Object(u["a"])(n["default"],r,c,!1,null,null,null,!1,i,s);t["default"]=p.exports},"865b":function(e,t,o){},d7c3:function(e,t,o){"use strict";o.r(t);var n=o("57eb"),a=o.n(n);for(var r in n)"default"!==r&&function(e){o.d(t,e,function(){return n[e]})}(r);t["default"]=a.a},e0c1:function(e,t,o){"use strict";(function(e){o("42eb"),o("921b");var t=s(o("66fd")),n=s(o("7154")),a=s(o("293f")),r=s(o("9b9f"));o("67a6");var c=s(o("c717")),i=s(o("65a5"));function s(e){return e&&e.__esModule?e:{default:e}}function u(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{},n=Object.keys(o);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(o).filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable}))),n.forEach(function(t){p(e,t,o[t])})}return e}function p(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var l=o("fb04")["default"],g={closed:!1,curOpenOpt:{},open:function(e){this.curOpenOpt=e,l.conn.open(e),this.closed=!1},reopen:function(){this.closed&&(l.conn.open(this.curOpenOpt),this.closed=!1)}};t.default.prototype.$im=l,t.default.prototype.$conn=g,t.default.config.productionTip=!1,t.default.prototype.$store=a.default,t.default.prototype.$http=r.default,t.default.prototype.$helper=c.default,t.default.prototype.$tool=i.default,n.default.mpType="app";var f=new t.default(u({store:a.default},n.default));e(f).$mount()}).call(this,o("6e42")["createApp"])},ef89:function(e,t,o){"use strict";var n=o("865b"),a=o.n(n);a.a}},[["e0c1","common/runtime","common/vendor"]]]);